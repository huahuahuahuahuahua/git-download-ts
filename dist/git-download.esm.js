Object.defineProperty(exports,"__esModule",{value:!0}),exports.getUrl=exports.addProtocal=exports.normalize=exports.download=void 0;var tslib_1=require("tslib"),download_1=tslib_1.__importDefault(require("download")),git_clone_1=tslib_1.__importDefault(require("git-clone")),rimraf_1=require("rimraf");function download(e,t,o,r){var i=o.clone||!1,e=(delete o.clone,normalize(e)),n=getUrl(e,i)||e.url;i?(i=tslib_1.__assign({checkout:e.checkout,shallow:"master"===e.checkout},o),console.log("cloneOptions",i),console.log("gitclone","url"+n,"dest"+t),console.log(i),(0,git_clone_1.default)(n,t,i,function(e){void 0===e?((0,rimraf_1.sync)(t+"/.git"),r()):r(e)})):(e=tslib_1.__assign(tslib_1.__assign({extract:!0,strip:1,mode:"666"},o),{headers:tslib_1.__assign({accept:"application/zip"},o.headers||{})}),(0,download_1.default)(n,t,e).then(function(){r()}).catch(function(e){r(e)}))}function normalize(e){var t,o=/^(?:(direct):([^#+])(?:#(.+))?)$/.exec(e);return o?{type:"direct",origin:o[2],owner:"",name:"",checkout:o[3]||"master",url:""}:(o=/^(?:(github|gitlab|bitbucket):)?(?:(.+):)?([^/]+)\/([^#]+)(?:#(.+))?$/.exec(e))?(e=o[1]||"github",null===(t=o[2]||"")&&("github"===e?t="github.com":"gitlab"===e?t="gitlab.com":"bitbucket"===e&&(t="bitbucket.org")),{type:e,origin:t,owner:o[3],name:o[4],checkout:o[5]||"master",url:""}):{type:"",origin:"",owner:"",name:"",checkout:"",url:""}}function addProtocal(e,t){return e=/^(f|ht)tps?:\/\//i.test(e)?e:t?"git@"+e:"https://"+e}function getUrl(e,t){var o="",r=addProtocal(e.origin,t);return/^git@/i.test(r)?r+=":":r+="/",t?o=r+e.owner+"/"+e.name+".git":"github"===e.type?o=r+e.owner+"/"+e.name+"/archive/"+e.checkout+".zip":"gitlab"===e.type?o=r+e.owner+"/"+e.name+"/repository/archive.zip?ref="+e.checkout:"bitbucket"===e.type&&(o=r+e.owner+"/"+e.name+"/get/"+e.checkout+".zip"),o}exports.download=download,exports.normalize=normalize,exports.addProtocal=addProtocal,exports.getUrl=getUrl,exports.default=download;
